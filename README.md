# 부스트캠프 AI Tech
[P Stage 3] Image segmentation and Detection



## 팀 소개

- **Detecting your mind SSAP possible**
- 조원 : [김태진](https://github.com/ktj9279), [김희섭](https://github.com/gan-ta), [김평화](https://github.com/Ajou201421102), [백서윤](https://github.com/seoyoonbaek), [송준영](https://github.com/jy1559), [주찬형](https://github.com/joochanhyeong)


## 대회 개요
![sementic_segmentation](https://user-images.githubusercontent.com/39492330/120090670-42a2d480-c13f-11eb-97f7-4095a30fea3a.png)

바야흐로 대량 생산, 대량 소비의 시대. 우리는 많은 물건이 대량으로 만들어져 쏟아져 나오고, 그에 따라 대량으로 소비되는 시대를 살고 있습니다. 하지만 이러한 문화는 심각한 쓰레기 문제를 낳고 있습니다. '쓰레기 대란', '매립지 부족'과 같은 표현을 뉴스에서 듣는 빈도가 점점 늘어나고 있다는 것만으로도 그 문제가 얼마나 심각한지 알 수 있습니다.

이러한 환경 부담을 조금이나마 줄일 수 있는 방법의 하나로 '분리수거'가 있습니다. 잘 분리배출 된 쓰레기는 자원으로서 가치를 인정받아 재활용되지만, 잘못 분리배출 되면 그대로 폐기물로 분류되어 매립, 소각되기 때문입니다. 우리나라의 분리 수거율은 굉장히 높은 것으로 알려져 있고, 또 최근 이러한 쓰레기 문제가 주목받으며 더욱 많은 사람이 분리수거에 동참하려 하고 있습니다. 하지만 '이 쓰레기가 어디에 속하는지', '어떤 것들을 분리해서 버리는 것이 맞는지' 등 정확한 분리수거 방법을 알기 어렵다는 문제점이 있습니다.

따라서, 우리는 **쓰레기가 찍힌 사진에서 쓰레기를 Segmentation / Detection 하는 모델**을 만들어 이러한 문제점을 해결해보고자 합니다. 문제 해결을 위한 데이터셋으로는 일반 쓰레기, 플라스틱, 종이, 유리 등 11 종류의 쓰레기가 찍힌 사진 데이터셋이 제공됩니다.

## 데이터 소개

## Wrap Up


## 실험 요약

### segmentation
|            Index           |                Model               |  Backbone (Encoder)  |            Pretrained Weights            |  mIOU  | Validation Loss |   Validation mIOU   | Loss Function (default: CE) | Optimizer (default: Adam) | Weight Decay (default: 1e-6) | Batch Size (default: 16) |  Learning Rate (default: 1e-3) | Seed (default: 14) | The Best Epoch (Validation) | Elapsed Time per Epoch |                               API                               |         JSON Filename         |
|:--------------------------:|:----------------------------------:|:--------------------:|:----------------------------------------:|:------:|:---------------:|:-------------------:|:---------------------------:|:-------------------------:|:----------------------------:|:------------------------:|:------------------------------:|:------------------:|:---------------------------:|:----------------------:|:---------------------------------------------------------------:|:-----------------------------:|
|                            | DeepLabV3 (decoder not pretrained) | resnext101_8d        | imagenet                                 | 0.5810 | ?               | 약 0.44             | CE                          | Adam                      | 1.0E-06                      | 8                        | 1.0E-04                        | 21                 | 7                           | 6 min.                 | torchvision.models.segmentation                                 | config_ResNext_deeplabv3.json |
|                            | DeepLabV3 (decoder not pretrained) | timm-EfficientNet-b7 | noisy-student                            | 0.5923 | 0.338           | 0.4613              | CE                          | Adam                      | 1.0E-06                      | 4                        | 1.0E-04                        | 21                 | 9                           | 8 min                  | https://github.com/rwightman/pytorch-image-models               | config_Effib7_deeplabv3.json  |
|                            | DeepLabV3 (receptive large)        | timm-EfficientNet-b7 | noisy-student                            | 0.5878 | no valid        | no valid            | CE                          | Adam                      | 1.0E-06                      | 4                        | 1.0E-04                        | 21                 | 8                           |                        |                                                                 | config_Effib7_deeplabv3.json  |
|                            | DeepLabV3+                         | resnext101_8d        | imagenet                                 | 0.6065 | -               | -                   | CE                          | Adam                      | 1.0E-06                      | 8                        | 5.0E-05                        | 14                 | 10                          | 14 min.                | segmentation_models.pytorch                                     |                               |
|                            | DeepLabV3+                         | se_resnext101_32x4d  | imagenet                                 | 0.5768 | 0.2758          | 0.5683              | CE                          | Adam                      | 1.0E-06                      | 8                        | 1.0E-04                        | 14                 | 7                           | 13 min                 | segmentation_models.pytorch                                     |                               |
|                            | DeepLabV3+                         | Regnety              | imagenet                                 | 0.5832 |                 | 0.5088(수정전 코드) | CE                          | Adam                      | 1.0E-06                      | 4                        | 1.0E-04                        | 21                 | 6                           | 18min                  |                                                                 |                               |
|                            | DeepLabV3+                         | timm-regnety_320     | imagenet(CLAHE TTA p=0.5)                | 0.5997 |                 | 0.5173              |  ce dice (0.75, 0.25)       | AdamP                     | 1.0E-05                      | 4                        | encoder: 1e-5, deconder : 1e-4 | 914                | 10                          | 18min                  | OneCycleLR                                                      |                               |
| best model + 윤곽선 필터링 | DeepLabV3+                         | resnext101_8d        | imagenet(CLAHE TTA p=0.5- 필터모델 적용) | 0.612  |                 |                     |                             |                           |                              |                          |                                |                    |                             |                        |                                                                 |                               |
|                            | DeepLabV3 (decoder not pretrained) | timm-EfficientNet-b7 | noisy-student                            | 0.5923 | 0.338           | 0.4613              | CE                          | Adam                      | 1.0E-06                      | 4                        | 1.0E-04                        | 21                 | 9                           | 8 min                  | https://github.com/rwightman/pytorch-image-models               | config_Effib7_deeplabv3.json  |
| train/valid LB에 맞게 변형 | DeepLabV3 (decoder not pretrained) | timm-EfficientNet-b7 | noisy-student                            | 0.5807 |                 | 0.5363              | BCE                         | Adam                      | 1.0E-06                      | 4                        | 5.0E-05                        | 14                 | 12                          | 10m                    | segmentation_models.pytorch                                     |                               |
| train/valid LB에 맞게 변형 | DeepLabV3 (decoder not pretrained) | timm-EfficientNet-b7 | noisy-student                            | 0.5804 |                 | 0.5202              | BCE+DICE                    | Adam                      | 1.0E-06                      | 4                        | 5.0E-05                        | 14                 | 16                          | 10m                    | segmentation_models.pytorch                                     |                               |
|                            | DeepLabV3 (decoder not pretrained) | timm-EfficientNet-b7 | noisy-student                            | 0.5826 |                 |                     | CE+Dice_loss                | Adam                      | 1.0E-06                      | 4                        | 1.0E-04                        | 14                 | 9                           | 20m                    | https://github.com/hubutui/DiceLoss-PyTorch/blob/master/loss.py |                               |


### object detection
|                Index                | Detector |      CNN Backbone      |    Neck    | Dense head, RoI head | Augmentation (default: RandomFlip TTA) | Validation Loss | Submission mAP | The Best Epoch  (Validation mAP) | Loss Function (cls / bbox) | Sheduler Config ( Epoch, Optimizer, etc) default : base (12,SGD)  | Learning Rate  (default: 1e-3) | Weight Decay  (default: 1e-6) | Batch Size (default: 4) | Seed (default: ?) | API (default: mmdetection) |
|:-----------------------------------:|:--------:|:----------------------:|:----------:|:--------------------:|:--------------------------------------:|:---------------:|:--------------:|:--------------------------------:|:--------------------------:|:-----------------------------------------------------------------:|:------------------------------:|:-----------------------------:|:-----------------------:|:-----------------:|:--------------------------:|
|                                     | SCNet    | ResNeSt-101            | FPN-CARAFE | RPN, Standard        | default                                |                 | 0.5103         | 25(0.282, 0.430)                 | CE/SmoothL1                | 26,Adam, [16,22]                                                  | 5.0E-05                        | default                       | 8                       | 2020              | default                    |
|                                     | SCNet    | ResNeSt-101            | PAN_CARAFE | RPN, Standard        | default                                |                 | 0.5014         | 19(0.282, 0.430)                 | CE/SmoothL1                | 25,Adam, [16,22]                                                  | 5.0E-05                        | default                       | default                 | 2020              | default                    |
| ms_train                            | SCNet    | ResNeSt-101            | FPN-CARAFE | RPN, Standard        | default                                |                 | 0.5078         | 20(0.277, 0.419)                 | CE/SmoothL1                | 25,Adam, [16,22]                                                  | 5.0E-05                        | default                       | default                 | 2020              | default                    |
| soft_nms 적용                       | SCNet    | ResNeSt-101            | FPN-CARAFE | RPN, Standard        | default                                |                 | 0.5105         | 25(0.279, 0.429)                 | CE/SmoothL1                | 25,Adam, [16,22]                                                  | 5.0E-05                        | default                       | default                 | 2020              | default                    |
|                                     | SCNet    | ResNeSt-101            | FPN-CARAFE |                      | v1                                     |                 | 0.5150         | 31 mAP_50: 0.426 mAP: 0.264      |                            | 36, AdamW, schedule_3x_adamw_step                                 | 1.0E-04                        | 0.05                          | 8                       | 2020              | default                    |
| mosaic Aug                          | HTC      | ResNeSt-101            | FPN-CARAFE | RPN, Standard        | default                                |                 | 0.5089         | 19(0.297, 0.451)                 | CE/SmoothL1                | 24,Adam, [16,22]                                                  | 5.0E-05                        | 0.000001                      | default                 | 2020              | default                    |
| mosaic Aug                          | HTC      | ResNeSt-101            | FPN-CARAFE | RPN, Standard        | default                                |                 | 0.5099         | 18(0.309,0.436)                  | CE/SmoothL1                | 24,Adam, [16,22]                                                  | 1.0E-04                        | 1.00E-05                      | default                 | 2020              | default                    |
| mosaic Aug적용                      | HTC      | ResNeSt-101(frozen -1) | FPN-CARAFE | RPN, Standard        | default                                |                 | 0.5025         | 22(0.305, 0.441)                 | CE/SmoothL1                | 24,Adam, [16,22]                                                  | 4.0E-01                        | 0.00001                       | default                 | 2020              | default                    |
| mosaic Aug적용                      | HTC      | ResNeSt-101            | FPN-CARAFE | RPN, Standard        | jin-v1.1                               |                 | 0.5188         | 28(0.301, 0.456)                 | CE/SmoothL1                | 36, AdamW, sheduler_tunning                                       | 1.0E-04                        | 0.05                          | 8                       | 2020              | default                    |
| WEB 앙상블 테스트 (0.4934 + 0. 4842) |          |                        |            |                      |                                        |                 | 0.5302         |                                  |                            |                                                                   |                                |                               |                         |                   |                            |
